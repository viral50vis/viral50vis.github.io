/*! viral-50 v0.0.1 | (c) 2020 Erik BÃ¥venstrand | MIT License | https://github.com/ErikBavenstrand/DH2321-Spotify-Project */
var chart,lineMarker,chartTooltip,prevTooltipDate,lineAttrMinY,lineAttrMaxY,chartCountryLines=[],globalLine=[],countryColors=["#ef4760","#fdd161","#2f8ba0"],usedCountryColors=[];countryColors.forEach((function(){usedCountryColors.push(!1)}));var container=d3.select("#linechart"),margin={top:15,right:30,bottom:20,left:50},totalWidth=+container.style("width").slice(0,-2),innerWidth=totalWidth-margin.left-margin.right,totalHeight=+container.style("height").slice(0,-2),innerHeight=totalHeight-margin.top-margin.bottom,xScale=d3.scaleTime().domain([new Date("2016-12-31"),new Date("2020-01-31")]).range([0,innerWidth]),yScale=d3.scaleLinear().range([innerHeight,0]),lineModel=d3.line().x((function(t){return xScale(t.x)})).y((function(t){return yScale(t.y)})).curve(d3.curveLinear);function mapDataToLine(t){var e=Object.values(data_attrs),a=[];e.filter((function(t,a){return a<e.length-2})).map((function(e){void 0!==e[t]&&a.push(e[t][currentAttribute])})),a.reverse();var n=weeks.length-a.length;return a=a.map((function(t,e){var a=weeks.length-1-(e+n);return{x:new Date(weeks[a]),y:t}}))}function changeLineChartAttribute(){updateLineChartMinMax(),1==globalLine.length&&loadGlobalLineData(),prevCountryLines=chartCountryLines,chartCountryLines=[],prevCountryLines.forEach((function(t){addCountryToLineChart(t.CC,t.color)}))}function updateLineChartMinMax(){lineAttrMinY=data_attrs.minimum[currentAttribute],lineAttrMaxY=data_attrs.maximum[currentAttribute],yScale.domain([lineAttrMinY,lineAttrMaxY]).nice()}function toggleGlobalLine(){0==globalLine.length?(loadGlobalLineData(),reloadLineChart()):(globalLine=[],reloadLineChart())}function loadGlobalLineData(){line=mapDataToLine("GLO"),globalLine=[{CC:"GLO",data:line,color:"#fff"}]}function addCountryToLineChart(t,e){var a,n=mapDataToLine(t);usedCountryColors.some((function(t,e){return t||(a=e),!t})),void 0!==e&&(a=e),usedCountryColors[a]=!0,chartCountryLines.push({CC:t,data:n,color:a}),reloadLineChart()}function removeCountryFromLineChart(t){chartCountryLines=chartCountryLines.filter((function(e){return e.CC!=t||(usedCountryColors[e.color]=!1,!1)})),reloadLineChart()}function reloadLineChart(){updateLineChartMinMax(),createLineChart(),chartCountryLines.forEach((function(t){drawLine(t),addDataPointDots(t)})),1===globalLine.length&&(drawLine(globalLine[0]),addDataPointDots(globalLine[0])),addGridLines(),changeLineChartWeek()}function createLineChart(){container.selectAll("svg").remove(),(chart=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).append("g").attr("transform","translate("+margin.left+","+margin.top+")")).append("g").attr("class","x axis").attr("transform","translate(0,"+innerHeight+")").call(d3.axisBottom(xScale).ticks(d3.timeMonth.every(1)).tickFormat((function(t,e){return e%12==0?d3.timeFormat("%Y")(t):""}))),chart.append("g").attr("class","y axis").call(d3.axisLeft(yScale)),lineMarker=chart.append("rect").attr("class","chart-marker").style("position","absolute").style("z-index","19").style("width","2px").style("height",innerHeight),d3.selectAll(".chart-tooltip").remove(),chartTooltip=container.append("div").attr("class","chart-tooltip").style("opacity",0).style("left",margin.left).style("top",totalHeight),prevTooltipX=0}function drawLine(t){var e="GLO"===t.CC;chart.append("path").attr("class","line line-loaded chart-element chart-element-"+t.CC).classed("line-loaded",!0).attr("stroke",e?t.color:countryColors[t.color]).data([t.data]).attr("d",lineModel)}function addGridLines(){chart.selectAll(".y.axis > .tick").each((function(){var t=d3.create("svg:line").attr("class","y-gridline").attr("x1",0).attr("x2",innerWidth);this.append(t.node())}))}function addDataPointDots(t){var e="GLO"===t.CC;chart.selectAll(".dot").data(t.data).enter().append("circle").attr("class","chart-dot chart-element-"+t.CC).attr("opacity","0.5").attr("cx",(function(t){return xScale(t.x)})).attr("cy",(function(t){return yScale(t.y)})).attr("r",3).attr("fill",e?t.color:countryColors[t.color])}function changeLineChartWeek(){var t=new Date(dataWeek),e=xScale(t);lineMarker.attr("x",e-.5+"px");var a=t;chart.selectAll(".chart-dot").classed("focus",(function(t){return+t.x==+a})).classed("nonfocus",(function(t){return+t.x!=+a})).each((function(e){+e.x==+a&&updateChartTooltip(e,t)}))}function updateChartTooltip(t,e){var a=xScale(e)+margin.left/2,n=margin.top-20,r="Y: "+t.y.toFixed(3);e!=prevTooltipDate&&chartTooltip.interrupt(),chartTooltip.transition().duration(200).delay(100).ease(d3.easeCubic).style("opacity",.85).style("left",a+"px").style("top",n+"px"),chartTooltip.html(r),prevTooltipDate=e}